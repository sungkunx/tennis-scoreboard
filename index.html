<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í…Œë‹ˆìŠ¤ ëŒ€ì§„í‘œ ìƒì„±ê¸°</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <style>
        /* ê¸°ë³¸ & ëª¨ë°”ì¼ ìŠ¤íƒ€ì¼ */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --danger-color: #dc3545;
            --success-color: #28a745;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--light-color);
            color: var(--dark-color);
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 15px;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 2px solid #eee;
            margin-bottom: 20px;
        }
        header h1 {
            margin: 0;
            color: var(--primary-color);
            flex-grow: 1;
            text-align: left;
        }
        #auth-container {
            display: flex;
            align-items: center;
        }
        #auth-btn, #settings-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.5rem;
            padding: 5px;
        }
        #settings-btn {
            display: none; /* Initially hidden */
            margin-right: 10px;
        }
        main {
            background-color: #ffffff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        section {
            margin-bottom: 25px;
        }
        h2, h3, h4 {
            color: var(--dark-color);
            margin-top: 0;
        }
        h2 { font-size: 1.4rem; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        h3 { font-size: 1.2rem; }
        h4 { font-size: 1.1rem; }

        /* í¼ ìŠ¤íƒ€ì¼ */
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
        }
        input[type="text"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 10px;
            font-size: 1rem;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }
        .player-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .player-row {
            display: grid;
            grid-template-columns: 30px 1fr 72px 64px 40px;
            gap: 8px;
            align-items: center;
        }
        .player-row input, .player-row select {
            padding: 8px;
            font-size: 0.9rem;
        }
        .player-number {
            font-weight: bold;
            color: #0056b3;
            text-align: center;
        }
        .btn {
            display: inline-block;
            width: 100%;
            padding: 12px;
            font-size: 1rem;
            font-weight: 600;
            color: #fff;
            background-color: var(--primary-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            box-sizing: border-box;
        }
        .btn-secondary { background-color: var(--secondary-color); }
        .btn-danger { background-color: var(--danger-color); }
        .btn-success { background-color: var(--success-color); }
        .btn-sm { padding: 8px 12px; font-size: 0.9rem; }
        .btn-xs { padding: 4px 8px; font-size: 0.8rem; width: auto; }

        /* ê²°ê³¼ í‘œì‹œ */
        #schedule-result { margin-top: 20px; }
        .round { margin-bottom: 20px; border: 1px solid #ddd; border-radius: 5px; overflow: hidden; }
        .round-title { background-color: var(--dark-color); color: #fff; padding: 10px 15px; font-weight: 600; }
        .match { padding: 15px; border-bottom: 1px solid #eee; }
        .match:last-child { border-bottom: none; }
        .match-info { font-weight: 600; margin-bottom: 8px; }
        .team { display: flex; justify-content: space-between; align-items: center; }
        .team-vs { font-weight: 600; color: var(--danger-color); margin: 0 10px; }
        .player-tag { display: inline-block; padding: 3px 8px; border-radius: 4px; font-size: 0.9rem; margin: 2px; }
        .player-male { background-color: #e6f2ff; color: #0056b3; }
        .player-female { background-color: #ffe6e6; color: #b30000; }
        .resting-players { padding: 10px 15px; background-color: #f9f9f9; font-style: italic; color: var(--secondary-color); }

        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        #loading { display: none; text-align: center; padding: 20px; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary-color); border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* ìˆ«ì ì…ë ¥ Stepper UI */
        .input-group-stepper { display: flex; align-items: center; }
        .input-group-stepper input { text-align: center; border-left: none; border-right: none; }
        .input-group-stepper .btn-stepper { width: 40px; flex-shrink: 0; padding: 10px; margin-top: 0; }
        .input-group-stepper .btn-stepper:first-child { border-top-right-radius: 0; border-bottom-right-radius: 0; }
        .input-group-stepper .btn-stepper:last-child { border-top-left-radius: 0; border-bottom-left-radius: 0; }
        #num-mixed { background-color: #e9ecef; }

        /* Modals */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4); }
        .modal.is-open { display: block; }
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 0;
            border: 1px solid #888;
            width: 90%;
            max-width: 500px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            max-height: 80vh;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #ddd; }
        .modal-footer { padding: 15px; border-top: 1px solid #ddd; background-color: #f9f9f9; }
        .modal-body { padding: 15px; overflow-y: auto; }
        .close-button { color: #aaa; float: right; font-size: 28px; font-weight: bold; }
        .close-button:hover, .close-button:focus { color: black; text-decoration: none; cursor: pointer; }
        
        /* Members Modal Specific Styles */
        #members-modal .modal-body { padding: 0 15px; }
        #saved-members-list { margin-bottom: 15px; }
        .member-item {
            display: grid;
            grid-template-columns: auto 1fr auto auto;
            gap: 10px;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        .member-item:last-child { border-bottom: none; }
        .member-item-info { display: flex; flex-direction: column; }
        .member-item-info span { font-size: 0.9rem; color: #555; }
        .member-item-actions { display: flex; gap: 5px; }
        .member-item-actions .btn-xs { font-size: 1rem; padding: 5px; line-height: 1; }

        #new-member-form {
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
            margin: 15px 0;
        }
        .gender-btn-group { display: flex; gap: 5px; }
        .gender-btn-group .btn { width: auto; flex-grow: 1; }
        .gender-btn-group .btn.active { background-color: var(--primary-color); color: white; }
        .gender-btn-group .btn:not(.active) { background-color: #ddd; color: #333; }
        #load-members-btn { background-color: #0056b3; } /* Darker blue for load members button */

        /* CSV Import Modal for Members */
        #csv-import-modal-for-members .modal-content { z-index: 1001; } /* Ensure it appears on top */
        #csv-textarea-members { height: 150px; font-family: monospace; }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>ğŸ¾ Tennis Draw Manager</h1>
            <div id="auth-container">
                <button id="settings-btn">ğŸ—‘ï¸</button>
                <button id="auth-btn">ğŸ”‘</button>
            </div>
        </header>

        <main>
            <p style="margin-bottom: 20px; color: #555; font-size: 0.95rem;">
                ì´ ë„êµ¬ëŠ” í…Œë‹ˆìŠ¤ ëª¨ì„ì˜ ê²Œì„ ëŒ€ì§„í‘œë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ìƒì„±í•˜ê³  ê´€ë¦¬í•˜ê¸° ìœ„í•´ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤.<br>
                ì°¸ê°€ì ì •ë³´ì™€ ê²Œì„ ì„¤ì •ì„ ì…ë ¥í•˜ê³  ìµœì ì˜ ëŒ€ì§„í‘œë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”.
            </p>
            <section id="participant-setup">
                <h2>ì°¸ì—¬ ì¸ì› ì„¤ì •</h2>
                <button id="load-members-btn" class="btn btn-secondary" style="margin-bottom: 10px; display: none;">ğŸ‘¥ ì €ì¥ëœ ë©¤ë²„ ë¶ˆëŸ¬ì˜¤ê¸°</button>
                <button id="csv-import-btn" class="btn btn-secondary" style="margin-bottom: 10px;">ğŸ“‹ CSVë¡œ ì°¸ì—¬ì¸ì› ì…ë ¥</button>
                <div id="csv-input-area" style="display: none; margin-bottom: 15px;">
                    <textarea id="csv-textarea" placeholder="ì´ë¦„,ì„±ë³„,ì‹¤ë ¥&#10;í™ê¸¸ë™,M,3&#10;ê¹€ì˜í¬,F,4&#10;&#10;ì„±ë³„: M(ë‚¨ì), F(ì—¬ì)&#10;ì‹¤ë ¥: 1(ìµœí•˜) ~ 5(ìµœìƒ)" style="width: 100%; height: 120px; padding: 10px; font-family: monospace; font-size: 0.9rem; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box;"></textarea>
                    <button id="csv-apply-btn" class="btn" style="margin-top: 5px;">CSV ì ìš©</button>
                </div>
                <div id="player-list-container" class="player-list">
                    </div>
                <button id="add-player-btn" class="btn btn-secondary">â• ì„ ìˆ˜ ì¶”ê°€</button>
            </section>

            <section id="game-setup">
                <h2>ê²Œì„ ì„¤ì •</h2>
                <div class="form-group">
                    <label for="num-courts">ì½”íŠ¸ ìˆ˜</label>
                    <input type="number" id="num-courts" value="2" min="1">
                </div>
                <div class="form-group">
                    <label for="num-rounds">ì´ ë¼ìš´ë“œ (íƒ€ì„) ìˆ˜</label>
                    <input type="number" id="num-rounds" value="5" min="1">
                </div>

                <div id="recommendation-box" style="background-color: #e7f3ff; padding: 15px; border-radius: 5px; margin-top: 15px; display: none;">
                    <h3 style="margin-top: 0; font-size: 1rem; color: #0066cc;">ì¶”ì²œ ê²Œì„ êµ¬ì„±</h3>
                    <div id="recommendation-content"></div>

                    <button id="optimize-btn" class="btn" style="margin-top: 10px; background-color: #28a745;">
                        âš¡ ìµœì  ê²Œì„ êµ¬ì„± ìë™ ê³„ì‚°
                    </button>
                    <div id="optimize-result" style="margin-top: 10px; padding: 10px; background-color: #d4edda; border-radius: 5px; display: none;">
                        <small id="optimize-message"></small>
                    </div>

                    <h3 style="margin-top: 15px; margin-bottom: 10px; font-size: 1rem; color: #0066cc;">ê²Œì„ êµ¬ì„± ì¡°ì •</h3>
                    <div class="form-group">
                        <label for="num-mixed">í˜¼í•© ë³µì‹ ìˆ˜ (ìë™ ê³„ì‚°)</label>
                        <div class="input-group-stepper">
                            <input type="number" id="num-mixed" value="0" min="0" readonly>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="num-mens">ë‚¨ì ë³µì‹ ìˆ˜</label>
                        <div class="input-group-stepper">
                            <button type="button" class="btn btn-secondary btn-stepper" data-step-down="num-mens">-</button>
                            <input type="number" id="num-mens" value="0" min="0">
                            <button type="button" class="btn btn-secondary btn-stepper" data-step-up="num-mens">+</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="num-womens">ì—¬ì ë³µì‹ ìˆ˜</label>
                        <div class="input-group-stepper">
                            <button type="button" class="btn btn-secondary btn-stepper" data-step-down="num-womens">-</button>
                            <input type="number" id="num-womens" value="0" min="0">
                            <button type="button" class="btn btn-secondary btn-stepper" data-step-up="num-womens">+</button>
                        </div>
                    </div>
                </div>
            </section>

            <button id="generate-btn" class="btn">â–¼ ëŒ€ì§„í‘œ ìƒì„±í•˜ê¸° â–¼</button>

            <div id="loading">
                <div class="spinner"></div>
                ì•Œê³ ë¦¬ì¦˜ì´ ìµœì ì˜ ëŒ€ì§„í‘œë¥¼ ê³„ì‚° ì¤‘ì…ë‹ˆë‹¤...
            </div>

            <section id="schedule-result">
                </section>

            <section id="player-statistics" style="display: none; margin-top: 20px;">
                </section>

            <section id="share-section" style="display: none; margin-top: 20px;">
                <button id="share-btn" class="btn">ğŸ“¤ ëŒ€ì§„í‘œ ê³µìœ í•˜ê¸°</button>
            </section>


        </main>
    </div>

    <script type="module" src="main.js"></script>

    <!-- Player Swap Modal -->
    <div id="swap-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="swap-modal-title">ì„ ìˆ˜ êµì²´</h3>
                <span class="close-button">&times;</span>
            </div>
            <div class="modal-body">
                <p>êµì²´í•  íœ´ì‹ ì„ ìˆ˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>
                <div id="swap-modal-resting-list" class="resting-player-list"></div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ëª¨ì„ ì½”ë“œë¡œ ë¡œê·¸ì¸</h3>
                <span class="close-button">&times;</span>
            </div>
            <div class="modal-body">
                <p>ëª¨ì„ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”. ì½”ë“œê°€ ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±ë©ë‹ˆë‹¤.</p>
                <input type="text" id="group-code-input" placeholder="ëª¨ì„ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <div class="modal-footer">
                <button id="login-submit-btn" class="btn">ë¡œê·¸ì¸ / ìƒì„±</button>
            </div>
        </div>
    </div>

    <!-- Member Management Modal -->
    <div id="members-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ë©¤ë²„ ê´€ë¦¬</h3>
                <span class="close-button">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group" style="display: flex; align-items: center; gap: 10px; padding: 10px 0;">
                    <input type="checkbox" id="select-all-members" style="width: auto;">
                    <label for="select-all-members" style="margin: 0; font-weight: normal;">ì „ì²´ ì„ íƒ</label>
                </div>
                <div id="saved-members-list"></div>
                
                <div id="new-member-form">
                    <h4>ìƒˆ ë©¤ë²„ ì¶”ê°€</h4>
                    <div class="form-group">
                        <input type="text" id="new-member-name" placeholder="ì´ë¦„">
                    </div>
                    <div class="form-group" style="display: flex; align-items: center; gap: 10px;">
                        <div class="gender-btn-group">
                            <button class="btn btn-sm active" data-gender="M">ë‚¨ì„±</button>
                            <button class="btn btn-sm" data-gender="F">ì—¬ì„±</button>
                        </div>
                        <select id="new-member-skill" style="width: auto; flex-grow: 1;">
                            <option value="1">ìµœí•˜</option>
                            <option value="2">í•˜</option>
                            <option value="3" selected>ì¤‘</option>
                            <option value="4">ìƒ</option>
                            <option value="5">ìµœìƒ</option>
                        </select>
                        <button id="add-new-member-btn" class="btn btn-sm btn-success">ì¶”ê°€</button>
                    </div>
                     <button id="csv-import-members-btn" class="btn btn-secondary btn-sm" style="width: 100%; margin-top: 10px;">CSVë¡œ ë©¤ë²„ ì¼ê´„ ì¶”ê°€</button>
                </div>
            </div>
            <div class="modal-footer">
                <button id="add-selected-members-btn" class="btn">ì„ íƒí•œ ë©¤ë²„ë¥¼ ì°¸ì—¬ì¸ì›ì— ì¶”ê°€</button>
            </div>
        </div>
    </div>

    <!-- CSV Import Modal for Members -->
    <div id="csv-import-modal-for-members" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>CSVë¡œ ë©¤ë²„ ì¶”ê°€</h3>
                <span class="close-button">&times;</span>
            </div>
            <div class="modal-body">
                <p>ì•„ë˜ í˜•ì‹ì— ë§ì¶° ë©¤ë²„ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
                <textarea id="csv-textarea-members" placeholder="ì´ë¦„,ì„±ë³„,ì‹¤ë ¥&#10;í™ê¸¸ë™,M,3&#10;ê¹€ì˜í¬,F,4"></textarea>
            </div>
            <div class="modal-footer">
                 <button type="button" class="btn btn-secondary" data-action="close-csv-modal">ì·¨ì†Œ</button>
                <button id="csv-apply-members-btn" class="btn">ì ìš©</button>
            </div>
        </div>
    </div>

</body>
</html>